<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorar Temas</title>
    <link rel="stylesheet" href="css/estilo.css">
</head>
<body>
    <div id="lista-wrapper">
        <nav>
            <a href="home.html" class="btn-nav">â¬… Volver</a>
            <h2 id="titulo-cat" style="margin:0; text-transform: uppercase; font-size: 1.1rem;">---</h2>
        </nav>

        <div class="container">
            <input type="text" id="buscador" class="buscador" placeholder="ðŸ”Ž Buscar por tÃ­tulo o artista...">
            <div id="lista" class="grid-huaynos"></div>
        </div>
    </div>

    <script type="module">
        import { auth, db } from "./firebase.js";
        import { baseDeTemas } from "./js/temas.js";
        import { vigilarSesion } from "./js/seguridad.js";

        // Vigilancia activa en la lista
        vigilarSesion(auth, db, "lista-wrapper");

        const params = new URLSearchParams(window.location.search);
        const catActual = params.get('cat') || 'huayno';
        document.getElementById("titulo-cat").innerText = catActual;

        const listaDiv = document.getElementById("lista");
        const buscador = document.getElementById("buscador");

        function render(filtro = "") {
            listaDiv.innerHTML = "";
            const filtrados = Object.keys(baseDeTemas)
                .map(id => ({ id, ...baseDeTemas[id] }))
                .filter(t => t.categoria === catActual)
                .filter(t => t.titulo.toLowerCase().includes(filtro.toLowerCase()));

            filtrados.forEach(t => {
                const card = document.createElement("a");
                card.href = `reproductor.html?id=${t.id}`;
                const claseColor = t.tonalidad.toLowerCase().replace(/\s+/g, '-');
                card.className = `card ${claseColor}`;
                card.innerHTML = `
                    <div style="display:flex; flex-direction:column;">
                        <span class="titulo">${t.titulo}</span>
                        <span style="font-size:0.7rem; color:#888;">${t.artista}</span>
                    </div>
                    <span class="tono-tag">${t.tonalidad !== "N/A" ? t.tonalidad : "TÃ©cnica"}</span>
                `;
                listaDiv.appendChild(card);
            });
        }

        buscador.oninput = (e) => render(e.target.value);
        render();
    </script>
</body>
</html>